<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tribunal">
    
    <title>Le Tribunal des Mythes - √âdition Int√©grale</title>
    <style>
        :root {
            --bg: #020617; --card-bg: #0f172a; --text: #f8fafc; --accent: #6366f1;
            --cat1: #3b82f6; --cat2: #f43f5e; --cat3: #d946ef; --cat4: #10b981;
            --neon-la-d: #facc15; --neon-la-zoz: #f43f5e; --neon-ste-marie: #38bdf8;
            --neon-aveugle: #818cf8; --neon-cloche: #4ade80; --neon-capitaine: #fb923c;
            --neon-opps: #a855f7; --neon-paf: #fb7185; --neon-kamikaze: #2dd4bf;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: var(--bg); color: var(--text); 
            margin: 0; display: flex; flex-direction: column; height: 100vh; 
            overflow: hidden; padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
            box-sizing: border-box;
        }

        .top-nav { display: flex; gap: 5px; padding: 10px; background: rgba(2, 6, 23, 0.95); justify-content: center; border-bottom: 1px solid #1e293b; z-index: 50; }
        .btn-tool { background: #0f172a; color: white; border: 1px solid #334155; padding: 8px 10px; border-radius: 10px; cursor: pointer; font-size: 0.65rem; font-weight: bold; text-transform: uppercase; }

        .tab-content { display: none; flex-direction: column; align-items: center; padding: 20px; flex: 1; overflow-y: auto; }
        .tab-content.active { display: flex; }

        #card-container { 
            position: relative; width: 85vw; max-width: 330px; height: 50vh; 
            margin: auto; perspective: 1200px; 
        }
        .game-card { 
            position: absolute; inset: 0; background: var(--card-bg); border-radius: 35px; 
            border: 4px solid var(--text); display: flex; flex-direction: column; 
            justify-content: center; padding: 25px; text-align: center; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
        }

        #overlay { 
            display: none; position: fixed; inset: 0; 
            background: var(--bg); z-index: 2000; 
            flex-direction: column; align-items: center; justify-content: center;
        }

        #role-display-area {
            display: none; flex-direction: column; align-items: center; width: 100%;
        }

        .role-card-ui { 
            width: 85vw; max-width: 330px; height: 55vh; background: #020617; border-radius: 35px; 
            border: 5px solid var(--accent); display: flex; flex-direction: column; 
            justify-content: center; align-items: center; padding: 25px; text-align: center; 
            box-shadow: 0 0 30px rgba(0,0,0,1); margin-bottom: 20px;
        }

        #overlay-btn { position: relative; z-index: 2100; width: 80vw; max-width: 300px; margin-top: 10px; }

        .role-name { font-size: 2.2rem; font-weight: 900; text-transform: uppercase; margin-bottom: 15px; line-height: 1; }
        .role-desc { font-size: 1rem; color: #ffffff; line-height: 1.4; }
        .player-info { font-size: 0.75rem; opacity: 0.5; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; }

        .neon-la-d { border-color: var(--neon-la-d); box-shadow: 0 0 20px var(--neon-la-d); } .neon-la-d .role-name { color: var(--neon-la-d); }
        .neon-la-zoz { border-color: var(--neon-la-zoz); box-shadow: 0 0 20px var(--neon-la-zoz); } .neon-la-zoz .role-name { color: var(--neon-la-zoz); }
        .neon-ste-marie { border-color: var(--neon-ste-marie); box-shadow: 0 0 20px var(--neon-ste-marie); } .neon-ste-marie .role-name { color: var(--neon-ste-marie); }
        .neon-aveugle { border-color: var(--neon-aveugle); box-shadow: 0 0 20px var(--neon-aveugle); } .neon-aveugle .role-name { color: var(--neon-aveugle); }
        .neon-cloche { border-color: var(--neon-cloche); box-shadow: 0 0 20px var(--neon-cloche); } .neon-cloche .role-name { color: var(--neon-cloche); }
        .neon-capitaine { border-color: var(--neon-capitaine); box-shadow: 0 0 20px var(--neon-capitaine); } .neon-capitaine .role-name { color: var(--neon-capitaine); }
        .neon-opps { border-color: var(--neon-opps); box-shadow: 0 0 20px var(--neon-opps); } .neon-opps .role-name { color: var(--neon-opps); }
        .neon-paf { border-color: var(--neon-paf); box-shadow: 0 0 20px var(--neon-paf); } .neon-paf .role-name { color: var(--neon-paf); }
        .neon-kamikaze { border-color: var(--neon-kamikaze); box-shadow: 0 0 20px var(--neon-kamikaze); } .neon-kamikaze .role-name { color: var(--neon-kamikaze); }

        .btn-main { background: var(--accent); color: white; border: none; padding: 18px; border-radius: 18px; font-weight: bold; width: 100%; max-width: 330px; cursor: pointer; font-size: 1.1rem; }
        input[type="text"] { width: 100%; max-width: 330px; padding: 16px; border-radius: 14px; border: 1px solid #1e293b; background: #0f172a; color: white; margin-bottom: 15px; font-size: 1rem; box-sizing: border-box; }
        .zoz-btn { background: #1e293b; color: white; border: 1px solid #334155; padding: 10px; margin: 4px; border-radius: 10px; width: 45%; cursor: pointer; font-size: 0.8rem; }
        .zoz-btn.selected { border-color: var(--accent); background: #312e81; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--card-bg); padding: 25px; border-radius: 25px; width: 100%; max-width: 350px; border: 1px solid #475569; max-height: 70vh; overflow-y: auto; }
        
        .slide-out { transform: translateY(-130%) rotate(-10deg); opacity: 0; }
        .slide-in { transform: translateY(100%) scale(0.9); opacity: 0; }
        .active-card { transform: translateY(0) scale(1); opacity: 1; }
        .cat-label { font-size: 0.85rem; font-weight: 900; letter-spacing: 2px; margin-bottom: 25px; text-transform: uppercase; }
        .cat-1 { border-color: var(--cat1); } .cat-1 .cat-label { color: var(--cat1); }
        .cat-2 { border-color: var(--cat2); } .cat-2 .cat-label { color: var(--cat2); }
        .cat-3 { border-color: var(--cat3); } .cat-3 .cat-label { color: var(--cat3); }
        .cat-4 { border-color: var(--cat4); } .cat-4 .cat-label { color: var(--cat4); }
    </style>
</head>
<body>

<div id="setup-tab" class="tab-content active">
    <h1>Le Tribunal</h1>
    <input type="text" id="p-name" placeholder="Pr√©nom du joueur...">
    <button class="btn-main" onclick="registerPlayer()">AJOUTER JOUEUR</button>
    <div id="list-names" style="margin: 20px 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;"></div>
    <button id="config-btn" class="btn-main" style="display:none; background:var(--cat4);" onclick="showRoleConfig()">CONFIGURER LES R√îLES</button>
</div>

<div id="config-tab" class="tab-content">
    <h2>R√¥les Actifs</h2>
    <div id="role-selector-list" style="width: 100%; max-width: 320px; margin-bottom: 20px;"></div>
    <button class="btn-main" onclick="validateAndStart()">D√âMARRER LA PARTIE</button>
</div>

<div id="game-tab" class="tab-content" style="padding: 0;">
    <div class="top-nav">
        <button class="btn-tool" onclick="toggleModal('modal-rules', true)">üìñ R√àGLES</button>
        <button class="btn-tool" onclick="toggleModal('modal-players', true)">üë§ JOUEURS</button>
        <button class="btn-tool" onclick="toggleModal('modal-active-roles', true)">üìú R√îLES</button>
    </div>
    <div id="turn-info" style="margin-top: 15px; font-weight: 800; font-size: 1.4rem; color: var(--accent);"></div>
    <div id="card-container"></div>
    <div style="width: 100%; display: flex; flex-direction: column; align-items: center; margin-bottom: 20px;">
        <button class="btn-main" onclick="drawCardWithAnimation()">PIOCHER UNE CARTE</button>
        <button onclick="location.reload()" style="background:none; border:none; color:gray; margin-top:10px; cursor:pointer; font-size:0.8rem;">‚úñ FIN DE PARTIE</button>
    </div>
</div>

<div id="modal-rules" class="modal"><div class="modal-content">
    <h2>R√®gles</h2><div style="text-align:left; font-size:0.9rem; line-height:1.5;">
    <p><b style="color:var(--cat1)">‚öñÔ∏è Accusation :</b> Avocat d√©fend (30s). Vote groupe. Perdant boit double.</p>
    <p><b style="color:var(--cat2)">üç∑ Beverage :</b> Les cartes rouges ne sortent jamais du deck.</p>
    </div><button class="btn-main" onclick="toggleModal('modal-rules', false)">RETOUR</button>
</div></div>

<div id="modal-players" class="modal"><div class="modal-content">
    <h3>Suivi Pouvoirs</h3><div id="player-dashboard"></div>
    <button class="btn-main" onclick="toggleModal('modal-players', false)">RETOUR</button>
</div></div>

<div id="modal-active-roles" class="modal"><div class="modal-content">
    <h3>R√¥les en jeu</h3><div id="active-roles-list"></div>
    <button class="btn-main" onclick="toggleModal('modal-active-roles', false)">RETOUR</button>
</div></div>

<div id="overlay">
    <div id="transition-screen" style="display:flex; flex-direction:column; align-items:center;">
        <h2 id="next-player-name" style="font-size: 1.8rem; margin-bottom: 30px;"></h2>
        <button class="btn-main" onclick="revealRoleNow()">D√âVOILER MON R√îLE</button>
    </div>
    
    <div id="role-display-area">
        <div id="role-screen" class="role-card-ui">
            <div id="overlay-player" class="player-info"></div>
            <div id="overlay-role" class="role-name"></div>
            <div id="overlay-desc" class="role-desc"></div>
            <div id="zoz-choice-container" style="display:none; flex-wrap:wrap; justify-content:center; margin-top:10px;"></div>
        </div>
        <button id="overlay-btn" class="btn-main" onclick="closeOverlay()">C'EST COMPRIS</button>
    </div>
</div>

<script>
    let players = [];
    let rolesData = {};
    let zozPartners = [];
    let currentIdx = 0;
    let deck = [];
    let isAnimating = false;

    const neonClasses = {
        "La D": "neon-la-d", "La Zoz": "neon-la-zoz", "La Sainte Marie": "neon-ste-marie",
        "L'Aveugle": "neon-aveugle", "Cloche Br√©silienne": "neon-cloche", "Le Cacapitaine": "neon-capitaine",
        "Le Opps": "neon-opps", "Paf": "neon-paf", "Le Kamikaze": "neon-kamikaze"
    };

    const allRoles = [
        { name: "La D", uses: 2, desc: "√Ä n‚Äôimporte quel moment dans la partie, cette personne peut servir un shot √† qui elle le veut (utilisable 2 fois sur 2 personnes diff√©rentes)." },
        { name: "La Zoz", uses: 0, desc: "Au d√©but de la partie, elle choisit une personne avec qui elle est li√©, ces deux personnes se connaissent et ne doivent pas se distribuer mutuellement de gorg√©es." },
        { name: "La Sainte Marie", uses: 3, desc: "Elle doit trouver qui sont les personnes li√©es (3 chances). Si elle trouve, les amoureux boivent un shot chacun." },
        { name: "L'Aveugle", uses: 2, desc: "√Ä n‚Äôimporte quel moment, cette personne peut servir un verre dos√© √† ¬´ l‚Äôaveugle ¬ª (utilisable 2 fois)." },
        { name: "Cloche Br√©silienne", uses: 2, desc: "Cette personne peut emp√™cher qui elle d√©sire de boire (y compris elle-m√™me). Utilisable 1x sur soi, 1x sur un autre." },
        { name: "Le Cacapitaine", uses: 2, desc: "Deux fois dans la partie, cette personne peut d√©cider de changer le destinataire d‚Äôun verre, d‚Äôune gorg√©e ou d‚Äôun shot." },
        { name: "Le Opps", uses: 0, desc: "Tu connais les Zoz. Ton r√¥le est de faire d√©couvrir √† la Sainte Marie qui ils sont sans te faire griller." },
        { name: "Paf", uses: 2, desc: "Pendant les cartes Beverage 'distribue...', tu peux dire PAF et distribuer toi-m√™me les gorg√©es (utilisable 2 fois)." },
        { name: "Le Kamikaze", uses: 1, desc: "√Ä tout moment, d√©signe quelqu'un : TIC-TAC. Il a 10s pour finir son verre. S'il r√©ussit, TU bois cul-sec. S'il √©choue, il boit tout." }
    ];

    const baseCards = [
        // CAT 1 : ACCUSATION
        {cat:1, text:"Qui est le plus susceptible de texter son ex apr√®s 3 verres ?"},
        {cat:1, text:"Qui est le plus mauvais conducteur du groupe ?"},
        {cat:1, text:"Qui pourrait participer √† une √©mission de t√©l√©-r√©alit√© ?"},
        {cat:1, text:"L'Infiltr√© : Qui est le plus susceptible de s'incruster √† un mariage ou une soir√©e o√π il n'est pas invit√© ?"},
        {cat:1, text:"Le Mytho : Qui est le plus capable de mentir avec un calme olympien pour se sortir d'une gal√®re ?"},
        {cat:1, text:"Le Survivor : Qui survivrait le plus longtemps dans un film d'horreur ?"},
        {cat:1, text:"L'innocent : qui mourrait en premier dans un film d'horreur ?"},
        {cat:1, text:"Le Mauvais Plan : Qui est le plus susceptible de finir avec un tatouage qu'il regrettera toute sa vie sur un coup de t√™te ?"},
        {cat:1, text:"Le Red Flag : Qui a le pire go√ªt en mati√®re de fr√©quentation amoureuse ?"},
        {cat:1, text:"Le Syndrome de Stockholm : Qui est le plus susceptible de tomber amoureux de quelqu'un qui ne le/la calcule absolument pas ?"},
        {cat:1, text:"Morph√©e : Qui est le plus susceptible de dispara√Ætre de la soir√©e sans pr√©venir personne pour aller dormir ?"},
        {cat:1, text:"Le Fugitif : Qui est le plus capable de partir de la soir√©e avec les chaussures (ou un v√™tement autre) de quelqu'un d'autre par erreur ?"},

        // CAT 2 : BEVERAGE
        {cat:2, text:"Bois 2 gorg√©es"}, {cat:2, text:"Bois 3 gorg√©es"}, {cat:2, text:"Bois 4 gorg√©es"},
        {cat:2, text:"Bois 5 gorg√©es"}, {cat:2, text:"Bois 1 shot"}, {cat:2, text:"Distribue 2 gorg√©es"},
        {cat:2, text:"Distribue 3 gorg√©es"}, {cat:2, text:"Distribue 4 gorg√©es"}, {cat:2, text:"Distribue 5 gorg√©es"},
        {cat:2, text:"Distribue 1 shot"},

        // CAT 3 : PACTE DU DIABLE
        {cat:3, text:"(D√©signe 3 personnes) : Avec qui pars-tu en vacances, avec qui tu ouvres un business, et qui tu laisses tomber en panne sur l'autoroute ?"},
        {cat:3, text:"(D√©signe 2 personnes) : Tu dois en sauver une d'un incendie, l'autre perd tous ses cheveux. Qui choisis-tu ?"},
        {cat:3, text:"(d√©signe 3 personnes) : Tu es sur une √Æle d√©serte. Avec qui tu te maries pour survivre, avec qui tu passes une nuit pour oublier ta solitude, et lequel tu sacrifies pour manger ?"},
        {cat:3, text:"(D√©signe 3 personnes) : tu vas mourir sauf si les conditions sont respect√©, choisi 3 personne. Une doit pr√™ter 1000‚Ç¨, une doit dire 5 blagues racistes, une doit se casser la gueule."},
        {cat:3, text:"(d√©signe 3 personnes) : kiss marry ou fuck (les autres choisisses les acteurs de la question)."},
        {cat:3, text:"Le Swap de vie : (D√©signe 2 personnes) : Tu dois √©changer ta famille avec l'un et ton compte bancaire avec l'autre."},
        {cat:3, text:"Les complices : (D√©signe 3 personnes) : Tu dois classer 3 personnes de celle que tu appellerais apr√®s un crime √† celle √† qui tu ne dirais rien."},

        // CAT 4 : DEFI FLASH
        {cat:4, text:"L'idiot : chaque fois que tu r√©pond a une question tu bois (hors question obligatoire, jusqu'√† la prochaine question)"},
        {cat:4, text:"Le fou : D√©signe deux personnes, elles doivent √©changer leurs verres"},
        {cat:4, text:"Le Sommelier : Remplis le prochain verre de la personne de ton choix avec les doses que tu veux"},
        {cat:4, text:"L'ivrogne : les autres te font ton prochain verre, dos√© √† leur souhait"},
        {cat:4, text:"Le Muet : Tu ne dois plus parler jusqu'√† ton prochain tour"},
        {cat:4, text:"Cascade : Tout le monde commence √† boire. Tu d√©cides du nombre de gorg√©e mais tu en bois 2 de plus"},
        {cat:4, text:"Le Miroir : Choisis un 'jumeau'. Chaque fois qu'il boit, tu bois. Chaque fois que tu bois, il boit (jusqu'√† la fin de la partie)."},
        {cat:4, text:"Le Sniper : Tu peux dire 'pouce'. Tout le monde doit toucher son menton. Le dernier boit 3 gorg√©es."},
        {cat:4, text:"Le try Harder : Tu peux dire 'pouce'. La premiere personne a toucher son menton boit 3 gorg√©es."},
        {cat:4, text:"Le roi : tu peux instaurer la regle de ton choix jusqu'a la fin de la partie"},
        {cat:4, text:"Le g√©olier : d√©signe deux personnes qui seront dans une cha√Æne (quand le premier boit, le second aussi)"},
        {cat:4, text:"Le Kamikaze : Bois un shot. Si tu le fais, d√©signe deux personnes qui doivent finir leur verre. Sinon, bois 5 gorg√©es."},
        {cat:4, text:"Le T-Rex : Garde les coudes coll√©s aux c√¥tes. Si tu d√©colles un coude : 2 gorg√©es (reexploitable) jusqu'√† ton prochain tour."},
        {cat:4, text:"Le Ma√Ætre des Pr√©noms : Interdiction d'appeler par le pr√©nom. 'Chef(fe)' ou 'Champion(ne)' uniquement. Erreur = 1 gorg√©e."},
        {cat:4, text:"Le Vote Blanc : Tu n'as plus le droit de donner ton avis lors d'un vote de plaidoirie"}
    ];

    function registerPlayer() {
        const val = document.getElementById('p-name').value.trim();
        if(val) { players.push(val); document.getElementById('p-name').value = ""; renderNames(); }
    }

    function renderNames() {
        document.getElementById('list-names').innerHTML = players.map(p => `<span style="background:#0f172a;padding:8px 12px;border:1px solid #1e293b;border-radius:10px;font-size:0.85rem;">${p}</span>`).join('');
        document.getElementById('config-btn').style.display = players.length >= 2 ? 'block' : 'none';
    }

    function showRoleConfig() {
        document.getElementById('setup-tab').classList.remove('active');
        document.getElementById('config-tab').classList.add('active');
        const rolesList = document.getElementById('role-selector-list');
        rolesList.innerHTML = allRoles.map((r, i) => `
            <div style="display:flex; justify-content:space-between; background:#0f172a; padding:12px; margin:8px 0; border-radius:12px; border:1px solid #1e293b;">
                <label style="font-weight:bold;">${r.name}</label>
                <input type="checkbox" id="role-${i}" checked style="width:20px; height:20px;">
            </div>
        `).join('');
    }

    function validateAndStart() {
        let pool = [];
        allRoles.forEach((r, i) => { if(document.getElementById(`role-${i}`).checked) pool.push({...r, currentUses:0}); });
        const duplicatables = ["La D", "L'Aveugle", "Cloche Br√©silienne", "Le Cacapitaine", "Paf", "Le Kamikaze"];
        let rolesToAssign = [...pool].sort(() => 0.5 - Math.random()).slice(0, players.length);
        while(rolesToAssign.length < players.length) {
            let dup = {...allRoles.find(r => duplicatables.includes(r.name))};
            rolesToAssign.push({...dup, currentUses: 0});
        }
        let finalMapping = new Array(players.length).fill(null);
        let pIdx = Array.from({length: players.length}, (_, i) => i);
        let zoz = rolesToAssign.find(r => r.name === "La Zoz");
        let opps = rolesToAssign.find(r => r.name === "Le Opps");
        if(zoz && opps) {
            let zIdx = Math.floor(Math.random() * (players.length - 1));
            finalMapping[zIdx] = zoz; rolesToAssign.splice(rolesToAssign.indexOf(zoz), 1);
            pIdx.splice(pIdx.indexOf(zIdx), 1);
            let pOpps = pIdx.filter(i => i > zIdx);
            let oIdx = pOpps[Math.floor(Math.random() * pOpps.length)];
            finalMapping[oIdx] = opps; rolesToAssign.splice(rolesToAssign.indexOf(opps), 1);
            pIdx.splice(pIdx.indexOf(oIdx), 1);
        }
        rolesToAssign.sort(() => 0.5 - Math.random());
        pIdx.forEach((idx, i) => finalMapping[idx] = rolesToAssign[i]);
        players.forEach((p, i) => rolesData[p] = finalMapping[i]);
        currentIdx = 0;
        document.getElementById('overlay').style.display = 'flex';
        prepareTransition();
    }

    function toggleModal(id, show) {
        document.getElementById(id).style.display = show ? 'flex' : 'none';
        if(show) {
            if(id === 'modal-players') updateDashboard();
            if(id === 'modal-active-roles') updateActiveRolesList();
        }
    }

    function updateDashboard() {
        const dash = document.getElementById('player-dashboard');
        dash.innerHTML = players.map(p => {
            const r = rolesData[p];
            let tokens = '';
            for(let i=1; i<=r.uses; i++) tokens += `<button style="background:var(--cat4);padding:6px;border-radius:5px;margin:2px;border:none;color:white;${r.currentUses >= i ? 'opacity:0.3;text-decoration:line-through;' : ''}" onclick="usePower('${p}', ${i})">${i}</button>`;
            return `<div style="padding:10px; border-bottom:1px solid #1e293b; display:flex; justify-content:space-between;">
                <span><b>${p}</b><br><small>${r.name}</small></span>
                <div>${tokens}</div>
            </div>`;
        }).join('');
    }

    function updateActiveRolesList() {
        const listContainer = document.getElementById('active-roles-list');
        const assignedRoles = [...new Set(Object.values(rolesData).map(r => r.name))];
        listContainer.innerHTML = assignedRoles.map(roleName => {
            const roleInfo = allRoles.find(r => r.name === roleName);
            return `<div style="border-bottom:1px solid #1e293b; padding:10px 0; text-align:left;">
                <b style="color:var(--accent); font-size:0.85rem;">${roleName}</b>
                <p style="font-size:0.75rem; opacity:0.8; margin:4px 0;">${roleInfo.desc}</p>
            </div>`;
        }).join('');
    }

    function usePower(p, i) { rolesData[p].currentUses = i; updateDashboard(); }

    function prepareTransition() {
        document.getElementById('role-display-area').style.display = 'none';
        document.getElementById('transition-screen').style.display = 'flex';
        document.getElementById('next-player-name').innerText = "√Ä ton tour, " + players[currentIdx];
    }

    function revealRoleNow() {
        const name = players[currentIdx];
        const data = rolesData[name];
        document.getElementById('transition-screen').style.display = 'none';
        document.getElementById('role-display-area').style.display = 'flex';
        const roleCard = document.getElementById('role-screen');
        roleCard.className = "role-card-ui " + (neonClasses[data.name] || "");
        document.getElementById('overlay-player').innerText = "IDENTIT√â DE " + name;
        document.getElementById('overlay-role').innerText = data.name;
        document.getElementById('overlay-desc').innerText = data.desc;
        const zozDiv = document.getElementById('zoz-choice-container');
        zozDiv.style.display = "none"; zozDiv.innerHTML = "";
        document.getElementById('overlay-btn').style.display = "block";
        if(data.name === "La Zoz") {
            document.getElementById('overlay-btn').style.display = "none";
            zozDiv.style.display = "flex";
            zozDiv.innerHTML = players.map(p => `<button class="zoz-btn" id="zoz-${p}" onclick="selectZoz('${p}')">${p}</button>`).join('');
        } else if(data.name === "Le Opps") {
            document.getElementById('overlay-desc').innerText += `\n\nLES ZOZ SONT : ${zozPartners.join(" et ")}`;
        }
    }

    function selectZoz(p) {
        if(zozPartners.includes(p)) zozPartners = zozPartners.filter(x => x !== p);
        else if(zozPartners.length < 2) zozPartners.push(p);
        document.querySelectorAll('.zoz-btn').forEach(b => b.classList.remove('selected'));
        zozPartners.forEach(x => document.getElementById(`zoz-${x}`)?.classList.add('selected'));
        document.getElementById('overlay-btn').style.display = (zozPartners.length === 2) ? "block" : "none";
    }

    function closeOverlay() {
        document.getElementById('zoz-choice-container').innerHTML = "";
        currentIdx++;
        if(currentIdx < players.length) prepareTransition();
        else {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('config-tab').classList.remove('active');
            document.getElementById('game-tab').classList.add('active');
            deck = [...baseCards]; currentIdx = 0; spawnInitialCard();
        }
    }

    function spawnInitialCard() {
        const card = getNextCardData();
        const el = createCardElement(card);
        el.classList.add('active-card');
        document.getElementById('card-container').appendChild(el);
        document.getElementById('turn-info').innerText = players[currentIdx];
    }

    function createCardElement(d) {
        const el = document.createElement('div');
        el.className = `game-card cat-${d.cat}`;
        const lbls = ["", "L'ACCUSATION", "BEVERAGE", "LE PACTE DU DIABLE", "D√âFI FLASH"];
        el.innerHTML = `<div class="cat-label">${lbls[d.cat]}</div><div style="font-size:1.3rem;font-weight:700">${d.text}</div>`;
        return el;
    }

    function getNextCardData() {
        if(deck.length === 0) deck = [...baseCards];
        const rIdx = Math.floor(Math.random() * deck.length);
        const c = deck[rIdx];
        if(c.cat !== 2) deck.splice(rIdx, 1);
        return c;
    }

    function drawCardWithAnimation() {
        if(isAnimating) return;
        isAnimating = true;
        const container = document.getElementById('card-container');
        const old = container.querySelector('.active-card');
        currentIdx = (currentIdx + 1) % players.length;
        const next = createCardElement(getNextCardData());
        next.classList.add('slide-in');
        container.appendChild(next);
        setTimeout(() => {
            if(old) { old.classList.remove('active-card'); old.classList.add('slide-out'); }
            next.classList.remove('slide-in'); next.classList.add('active-card');
            document.getElementById('turn-info').innerText = players[currentIdx];
        }, 50);
        setTimeout(() => { if(old) old.remove(); isAnimating = false; }, 650);
    }
</script>
</body>
</html>
